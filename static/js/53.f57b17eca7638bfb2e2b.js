webpackJsonp([53],{SP8C:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Au9i"),i=(s("EAZf"),{name:"appealDetail",data:function(){return{title:"工单详情",imgs:[],imgFile:[],appealDesc:"",id:0,lastDetailId:0,data:{},chat:[],timer:null,show:!0,modelPay:!1,showImg:!1,imgSrc:"",show1:!1,sureModelPay:!1}},computed:{token:function(){return this.$store.state.token},userId:function(){return this.$store.state.userId},sessionId:function(){return this.$store.state.sessionId}},watch:{token:{handler:function(t){t&&this.getDetails()},deep:!0}},mounted:function(){window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1))},created:function(){this.$route.query.id&&(this.id=this.$route.query.id,localStorage.setItem("workOrderId",this.id),localStorage.setItem("lastDetailId",this.lastDetailId)),this.token&&this.getDetails()},methods:{getDetails:function(){var t=this;t.timer&&clearTimeout(t.timer);var e={workOrderId:this.id,lastDetailId:this.lastDetailId,userId:this.userId,sktSessionId:this.sessionId};t.$axios.post("/fhWorkOrder/getDetails",e).then(function(e){e.data.ok?(t.data=e.data,e.data.detailList.length>0&&(t.chat=e.data.detailList,t.scrollDown()),e.data.end&&(t.sureModelPay=!0,t.modelPay=!1,localStorage.removeItem("workOrderId"),localStorage.removeItem("lastDetailId"),clearTimeout(t.timer)),t.timer=setTimeout(function(){t.getDetails()},5e3)):Object(a.Toast)(e.data.msg)})},scrollDown:function(){var t=this.$refs.talkBox,e=t.scrollHeight,s=t.scrollTop,a=e-s;if(a>0){window.scroll_down_interval>0&&(clearInterval(window.scroll_down_interval),window.scroll_down_interval=0);var i=Math.round(a/60);window.scroll_down_interval=setInterval(function(){(s+=i)>=e?(t.scrollTop=t.scrollHeight,clearInterval(window.scroll_down_interval),window.scroll_down_interval=0):t.scrollTop=s},5)}},submitAppeal:function(){var t=this,e=new FormData;if(0===this.imgFile.length&&""===this.appealDesc)"zh-CN"==t.$i18n.locale?Object(a.Toast)("不能发送空消息"):Object(a.Toast)("Unable to send empty messages");else{e.append("desc",this.appealDesc),e.append("userId",this.userId),e.append("sktSessionId",this.sessionId),e.append("replayWorkOrderId",this.id);for(var s=0;s<this.imgFile.length;s++)e.append("files",this.imgFile[s]);a.Indicator.open(),this.$axios.post("/fhWorkOrder/replay",e).then(function(e){a.Indicator.close(),e.data.ok?(t.getDetails(),t.imgs=[],t.imgFile=[],t.appealDesc="",t.show=!0):Object(a.Toast)(e.data.msg)})}},addImg:function(t){var e=t.target.files,s=this;if(e.length>0){if(e.length+this.imgFile.length>9)return"zh-CN"==s.$i18n.locale?Object(a.Toast)("上传不能超过9张图片"):Object(a.Toast)("Upload no more than 9 pictures"),t.target.value="",!1;for(var i=0;i<e.length;i++)if(e[i].size>10485760)return"zh-CN"==s.$i18n.locale?Object(a.Toast)("图片大小不能超过10M"):Object(a.Toast)("Picture size should not exceed 10M"),t.target.value="",!1}var o=0;for(i=0;i<e.length;i++)s.base(e[i],function(a,i){++o>=e.length&&(t.target.value=""),s.imgs.push(a),s.imgFile.push(s.dataURLtoFile(a,i))});this.imgs.length>=8?this.show=!1:this.show=!0},del:function(t){this.imgs.splice(t,1),this.imgFile.splice(t,1),this.imgs.length>=9?this.show=!1:this.show=!0},overWorker:function(){var t=this,e={workOrderId:this.id,userId:this.userId,sktSessionId:this.sessionId};t.$axios.post("/fhWorkOrder/end",e).then(function(e){e.data.ok?(localStorage.removeItem("workOrderId"),localStorage.removeItem("lastDetailId"),t.timer&&clearTimeout(t.timer),Object(a.Toast)(e.data.msg),setTimeout(function(){t.$router.push("/my")},1600)):Object(a.Toast)(e.data.msg)})},clickImg:function(t){this.showImg=!0,this.imgSrc=t.currentTarget.src,this.show1=!1},viewImg:function(){this.showImg=!1},back:function(){this.$router.push("/my")},goBack:function(){this.$router.replace({path:"/my"})}},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1),clearTimeout(this.timer)},components:{commomHead:s("2Hch").a}}),o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"appealDetail2"},[s("div",{staticClass:"top"},[s("div",{staticClass:"bar"},[s("i",{staticClass:"iconfont icon-jiantou_xiangzuo",on:{click:function(e){t.debounce(t.back,300)}}}),t._v(" "),s("span",{staticClass:"title"},[t._v("工单详情")])])]),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"appealBox"},[s("div",{staticClass:"tit"},[t._v(t._s(t.$t("m.appealDetail.message"))+":")]),t._v(" "),s("ul",{staticClass:"listCon",attrs:{id:"msgBox"}},[s("li",[s("span",[t._v(t._s(t.$t("m.appealDetail.submit"))+" :")]),t._v(" "),s("span",{staticClass:"sp1"},[t._v(t._s(t.data.author))])]),t._v(" "),s("li",[s("span",[t._v(t._s(t.$t("m.appealDetail.handle"))+" :")]),t._v(" "),s("span",{staticClass:"sp2"},[t._v(t._s(t.data.handler))])]),t._v(" "),s("li",[s("span",[t._v(t._s(t.$t("m.appealDetail.time"))+" :")]),t._v(" "),s("span",{staticClass:"sp3"},[t._v(t._s(t.data.createAt))])])]),t._v(" "),s("div",{staticClass:"over",on:{click:function(e){t.modelPay=!0}}},[t._v(t._s(t.$t("m.appealDetail.over")))])]),t._v(" "),s("div",{ref:"talkBox",staticClass:"talkBox"},t._l(t.chat,function(e,a){return s("div",{key:a,staticClass:"talk",attrs:{id:"talkBox"}},[e.operatorName==t.data.author?s("div",{staticClass:"my"},[s("p",{staticClass:"user"},[s("strong",[t._v(t._s(e.operatorName))])]),t._v(" "),e.desc?s("p",{staticClass:"txt",domProps:{innerHTML:t._s(e.desc)}},[t._v(t._s(e.desc))]):t._e(),t._v(" "),s("div",{staticClass:"pic"},[s("viewer",[e.img0?s("img",{attrs:{src:e.img0,alt:"","data-original":"item.img0"}}):t._e(),t._v(" "),e.img1?s("img",{attrs:{src:e.img1,"data-original":"item.img1"}}):t._e(),t._v(" "),e.img2?s("img",{attrs:{src:e.img2,"data-original":"item.img2"}}):t._e()])],1),t._v(" "),s("p",{staticClass:"time"},[t._v(t._s(e.createAt))])]):t._e(),t._v(" "),e.operatorName==t.data.handler?s("div",{staticClass:"others"},[s("p",{staticClass:"user"},[s("strong",[t._v(t._s(e.operatorName))])]),t._v(" "),e.desc?s("p",{staticClass:"txt",domProps:{innerHTML:t._s(e.desc)}},[t._v(t._s(e.desc))]):t._e(),t._v(" "),s("div",{staticClass:"pic"},[s("viewer",[e.img0?s("img",{attrs:{src:e.img0,alt:"","data-original":"item.img0"}}):t._e(),t._v(" "),e.img1?s("img",{attrs:{src:e.img1,"data-original":"item.img1"}}):t._e(),t._v(" "),e.img2?s("img",{attrs:{src:e.img2,"data-original":"item.img2"}}):t._e()])],1),t._v(" "),s("p",{staticClass:"time"},[t._v(t._s(e.createAt))])]):t._e()])})),t._v(" "),s("div",{staticClass:"enterBox"},[s("div",{staticClass:"inp clearfix"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.appealDesc,expression:"appealDesc"}],staticClass:"fl",attrs:{type:"text",placeholder:t.$t("m.appealDetail.placeholder")},domProps:{value:t.appealDesc},on:{input:function(e){e.target.composing||(t.appealDesc=e.target.value)}}}),t._v(" "),s("button",{staticClass:"fr",on:{click:function(e){t.debounce(t.submitAppeal,1e3)}}},[t._v("发送")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"uploadDIv fr"},[s("i",{staticClass:"iconfont icon-tupian"}),t._v(" "),s("input",{staticClass:"fileTest",attrs:{type:"file",name:"file",multiple:"multiple",id:"inputs",accept:"image/*"},on:{change:function(e){t.addImg(e)}}})])]),t._v(" "),t.imgs.length>0?s("div",{staticClass:"uploadBox"},t._l(t.imgs,function(e,a){return s("div",{key:a,staticClass:"divImg uploadImg"},[s("img",{staticClass:"imgBIMG",attrs:{src:e,alt:""}}),t._v(" "),s("i",{staticClass:"iconfont icon-guanbi deleteImg",on:{click:function(e){t.del(a)}}})])})):t._e()])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.modelPay,expression:"modelPay"}],staticClass:"modelPay"},[s("div",{staticClass:"cont"},[s("div",{staticClass:"conform"},[s("p",[s("strong",[t._v(t._s(t.$t("m.appealDetail.sureOver")))])]),t._v(" "),s("p",[s("strong",[t._v(t._s(t.$t("m.appealDetail.content")))])]),t._v(" "),s("div",{staticClass:"btn clearfix"},[s("button",{staticClass:"fl",on:{click:function(e){t.modelPay=!1}}},[t._v(t._s(t.$t("m.appealDetail.noOver")))]),t._v(" "),s("button",{staticClass:"fr",on:{click:function(e){t.debounce(t.overWorker,1e3)}}},[t._v(t._s(t.$t("m.appealDetail.sureOver")))])])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.sureModelPay,expression:"sureModelPay"}],staticClass:"modelPay"},[s("div",{staticClass:"cont"},[s("div",{staticClass:"conform"},[s("p",[s("strong",[t._v(t._s(t.$t("m.appealDetail.tip")))])]),t._v(" "),s("p",[s("strong",[t._v(t._s(t.$t("m.appealDetail.tipContent")))])]),t._v(" "),s("div",{staticClass:"btn clearfix"},[s("button",{staticClass:"sureover",on:{click:function(e){t.$router.push("/my")}}},[t._v(t._s(t.$t("m.appealDetail.know")))])])])])])])},staticRenderFns:[]},l=s("VU/8")(i,o,!1,function(t){s("gnX7")},"data-v-71d3e712",null);e.default=l.exports},gnX7:function(t,e){}});